<Window x:Class="Rfx.Riken.OsakaUniv.AnalysisParamSetForLcWin"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:local="clr-namespace:Rfx.Riken.OsakaUniv;assembly=CommonMVVM"
        Loaded="Window_Loaded"
        Title="Analysis parameter setting" 
        Height="630" Width="650">
    <i:Interaction.Behaviors>
        <local:ValidationBehavior HasViewError="{Binding HasViewError, Mode=OneWayToSource}" />
    </i:Interaction.Behaviors>
    <Window.Resources>
        <ControlTemplate x:Key="InputErrorTemplate">
            <DockPanel>
                <TextBlock DockPanel.Dock="Right" Text="!" Foreground="Red" FontSize="18" FontWeight="Bold" Margin="5,2"/>
                <AdornedElementPlaceholder/>
            </DockPanel>
        </ControlTemplate>
        <Style x:Key="ToolTipErrorStyle" TargetType="{x:Type TextBox}">
            <Setter Property="Validation.ErrorTemplate" Value="{StaticResource InputErrorTemplate}"/>
            <Style.Triggers>
                <Trigger Property="Validation.HasError" Value="True">
                    <Setter Property="ToolTip" Value="{Binding Path=(Validation.Errors)[0].ErrorContent, RelativeSource={RelativeSource Self}}" />
                    <Setter Property="BorderBrush" Value="Pink" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="40" />
        </Grid.RowDefinitions>
        <TabControl Grid.Row="0" Name="TabControl_ParameterSetting" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <TabItem Name="TabItem_DataCollection" Header="Data collection">
                <Grid>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="90" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                       
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Label Content="Mass accuracy (centroid parameter)" FontStyle="Italic" Margin="10,0,0,0" />

                        <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 25, 0,0">
                            <Label Content="MS1 tolerance:" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="MS2 tolerance:" Height="30" VerticalContentAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 25, 0,0">
                            <TextBox Name="TextBox_CentroidMs1Tolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="CentroidMs1Tolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="This is one of parameters for peak detections. This software utilizes &quot;slice&quot; XIC chromatogram. At least for Q-TOF, 0.01-0.05 is better. The detail algorithm should be published soon." />
                                </ToolTipService.ToolTip>
                            </TextBox>
                            <TextBox Name="TextBox_CentroidMs2Tolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="CentroidMs2Tolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="This is a parameter to draw MS^2 chromatograms. At least for Q-TOF, 0.05-0.1 is better. The detail algorithm should be published soon." />
                                </ToolTipService.ToolTip>
                            </TextBox>

                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 25, 0,0">
                            <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>
                        </StackPanel>


                    </Grid>

                    <Grid Grid.Row="1">
                    
                        <Expander Header="Advanced"
                                  HorizontalAlignment="Stretch" 
                                  VerticalAlignment="Top" 
                                  ExpandDirection="Down">

                            <Grid>
                              
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Label Content="Data collection parameters" FontStyle="Italic" Margin="10,0,0,0" />

                                <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 25, 0,0">
                                    <Label Content="Retention time begin:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Retention time end:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="MS1 mass range begin:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="MS1 mass range end:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="MS/MS mass range begin:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="MS/MS mass range end:" Height="30" VerticalContentAlignment="Center"/>
                                </StackPanel>
                           
                                <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 25, 0,0">
                                    <TextBox Name="TextBox_RetentionTimeBegin" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="RetentionTimeBegin" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="You can remove un-wanted retention time range." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>
                                    <TextBox Name="TextBox_RetentionTimeEnd" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="RetentionTimeEnd" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="You can remove un-wanted retention time range." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>
                                    
                                    <TextBox Name="TextBox_MassRangeBegin" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="MassRangeBegin" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnSourceUpdated="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="You can remove un-wanted mass range." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                    <TextBox Name="TextBox_MassRangeEnd" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="MassRangeEnd" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnSourceUpdated="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="You can remove un-wanted mass range." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                    <TextBox Name="TextBox_Ms2MassRangeBegin" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                             HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="Ms2MassRangeBegin" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnSourceUpdated="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="You can remove un-wanted mass range." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                    <TextBox Name="TextBox_Ms2MassRangeEnd" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="Ms2MassRangeEnd" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnSourceUpdated="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="You can remove un-wanted mass range." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>


                                </StackPanel>
                                <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 25, 0,0">
                                    <Label Content="min" Height="30" VerticalAlignment="Center"/>
                                    <Label Content="min" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>
                                </StackPanel>

                                <Label Content="Isotope recognition" FontStyle="Italic" Margin="10,210,0,0" />

                                <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 235, 0,0">
                                    <Label Content="Maximum charged number:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Consider Cl and Br elements:" Height="30" VerticalContentAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 235, 0,0">
                                    <TextBox Name="TextBox_MaximumChargedState" 
                                 Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                 HorizontalAlignment="Stretch" 
                                 HorizontalContentAlignment="Right"
                                 Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="MaxChargeNumber" 
                                         ValidatesOnDataErrors="True" 
                                         UpdateSourceTrigger="LostFocus"
                                         NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveIntNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="For small molecule profiling, 2 is recommended. For proteome or siRNA researches, multiple charged state (8 or more) should be used." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                    <CheckBox Name="CheckBox_IsConsiderBrClForIsotopes" 
                                        HorizontalAlignment="Left" 
                                        VerticalAlignment="Center" 
                                        Grid.Column="1"
                                        IsEnabled="True"
                                        IsChecked="{Binding Path=IsBrClConsideredForIsotopes}" 
                                        Margin="5,10,0,0" Height="25" Width="25">

                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="If checked, the criterion of 'monotonically decreasing ions' is not used for isotope recognitions." />
                                        </ToolTipService.ToolTip>

                                    </CheckBox>

                                </StackPanel>

                                <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 235, 0,0">
                                    
                                </StackPanel>
                            
                                <Label Content="Multithreading" FontStyle="Italic" Margin="10,300,0,0" />

                                <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 325, 0,0">
                                    <Label Content="Number of threads:" Height="30" VerticalContentAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 325, 0,0">
                                    <TextBox Name="TextBox_NumThreads" 
                                 Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                 HorizontalAlignment="Stretch" 
                                 HorizontalContentAlignment="Right"
                                 Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="NumThreads" 
                                         ValidatesOnDataErrors="True" 
                                         UpdateSourceTrigger="LostFocus"
                                         NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveIntNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="This is one of parameters for peak detections. 1-2 is better for a laptop." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                </StackPanel>

                                <Label Content="Execute retention time corrections" FontStyle="Italic" Margin="10,360,0,0" />

                                <CheckBox Name="CheckBox_ExcuteRtCorrectoin" 
                                    HorizontalAlignment="Left" 
                                    VerticalAlignment="Center" 
                                    Grid.Column="1"
                                    IsEnabled="True"
                                    IsChecked="{Binding Path=ExcuteRtCorrection}" 
                                    Margin="5,365,0,0" Height="25" Width="25">

                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="If checked, RT correction wizard is shown after the parameter setup." />
                                    </ToolTipService.ToolTip>

                                </CheckBox>
                            </Grid>
                            
                        </Expander>


                    </Grid>

                </Grid>
            </TabItem>

            <TabItem Name="TabItem_PeakDetection" Header="Peak detection" Height="22" VerticalAlignment="Top">
                <Grid>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="90" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Label Content="Peak detection parameters" Grid.Row="0" FontStyle="Italic" Margin="10,0,0,0" />

                        <StackPanel Orientation="Vertical" Grid.Column="0"  Grid.Row="0" Margin="20, 25, 0,0">
                            <Label Content="Minimum peak height:" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="Mass slice width:" Height="30" VerticalContentAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="1" Grid.Row="0" Margin="0, 25, 0,0">

                            <TextBox Name="TextBox_MinimumAmplitude" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                     HorizontalAlignment="Stretch" 
                                     HorizontalContentAlignment="Right" 
                                     Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="MinimumAmplitude" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="Recommend: 1000-3000 (QTOF), 10000-30000 (Orbitrap, FT-MS)" />
                                </ToolTipService.ToolTip>
                            </TextBox>

                            <TextBox Name="TextBox_MassSliceWidth" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                     HorizontalAlignment="Stretch" 
                                     HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="MassSliceWidth" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="Recommend: 0.05-0.1" />
                                </ToolTipService.ToolTip>
                            </TextBox>
                            
                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="2" Grid.Row="0" Margin="0, 25, 0,0">
                            <Label Content="amplitude" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>
                        </StackPanel>

                    </Grid>

                    <Grid Grid.Row="1">
                        <Expander Header="Advanced"
                                  HorizontalAlignment="Stretch" 
                                  VerticalAlignment="Stretch" 
                                  ExpandDirection="Down">
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Grid.RowDefinitions>
                                    <RowDefinition Height="90" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>  

                                <!--<Label Content="Advanced parameters" Grid.Row="0" FontStyle="Italic" Margin="10,0,0,0" />-->

                                <StackPanel Orientation="Vertical" Grid.Column="0"  Grid.Row="0" Margin="20, 0, 0,0">
                                    <Label Content="Smoothing method:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Smoothing level:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Minimum peak width:" Height="30" VerticalContentAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Orientation="Vertical" Grid.Column="1" Grid.Row="0" Margin="0, 0, 0,0">
                                    <ComboBox Name="ComboBox_SmoothingMethod" ItemsSource="{Binding}" SelectionChanged="ComboBox_SmoothingMethod_SelectionChanged" HorizontalContentAlignment="Left" HorizontalAlignment="Stretch" Height="25" Margin="5,2.5,5,2.5">
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="Linear weighted moving average is recommended." />
                                        </ToolTipService.ToolTip>
                                    </ComboBox>
                                    <TextBox Name="TextBox_SmoothingLevel" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="SmoothingLevel" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveIntNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="Recommend: 2-4 (if a peak have just 5-10 data points)" />
                                        </ToolTipService.ToolTip>
                                    </TextBox>
                                    <TextBox Name="TextBox_MinimumDatapoints" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="MinimumDatapoints" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="Recommend: 3-5" />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                </StackPanel>
                                <StackPanel Orientation="Vertical" Grid.Column="2" Grid.Row="0" Margin="0, 0, 0,0">
                                    <Label Content="" Height="30" VerticalAlignment="Center"/>
                                    <Label Content="scan" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="scan" Height="30" VerticalContentAlignment="Center"/>
                                </StackPanel>

                                <Label Content="Exclusion mass list:" Height="30" Grid.Column="0" Grid.Row="1" VerticalAlignment="Top" Margin="20,5,0,0" />

                                <DataGrid Name="DataGrid_ExcludeMassSetting" 
                                          ItemsSource="{Binding Path=ExcludedMassViewModelCollection}" 
                                          Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1" 
                                          VerticalAlignment="Stretch"
                                          Margin="5,8,5,0" CanUserAddRows="False" CanUserDeleteRows="False" 
                                          CanUserReorderColumns="False" CanUserSortColumns="False"
                                          SelectionUnit="Cell" IsReadOnly="False" HeadersVisibility="All" 
                                          AutoGenerateColumns="False" 
                                          CurrentCellChanged="DataGrid_ExcludeMassSetting_CurrentCellChanged" 
                                          PreviewKeyDown="DataGrid_ExcludeMassSetting_PreviewKeyDown" > 
                                 
                                    <DataGrid.ColumnHeaderStyle>
                                        <Style TargetType="DataGridColumnHeader" >
                                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                        </Style>
                                    </DataGrid.ColumnHeaderStyle>

                                    <DataGrid.Columns>

                                        <DataGridTemplateColumn Width="*" Header="Accurate mass [Da]" IsReadOnly="False">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBox Name="TextBox_ExcludedMass" 
                                                 Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                                 VerticalContentAlignment="Center">
                                                        <TextBox.Text>
                                                            <Binding Path="ExcludedMass" 
                                                         ValidatesOnDataErrors="True" 
                                                         UpdateSourceTrigger="LostFocus" 
                                                         NotifyOnValidationError="True">
                                                                <Binding.ValidationRules>
                                                                    <local:PositiveDoubleNumericValidation />
                                                                </Binding.ValidationRules>
                                                            </Binding>
                                                        </TextBox.Text>
                                                    </TextBox>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>

                                            <DataGridTemplateColumn.CellEditingTemplate>
                                                <DataTemplate>
                                                    <Grid  FocusManager.FocusedElement="{Binding ElementName= TextBox_ExcludedMass}">
                                                        <TextBox Name="TextBox_ExcludedMass" 
                                                     Text="{Binding ExcludedMass, UpdateSourceTrigger=LostFocus}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellEditingTemplate>
                                        </DataGridTemplateColumn>

                                        <DataGridTemplateColumn Width="*" Header="Mass tolerance [Da]" IsReadOnly="False">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBox Name="TextBox_MassTolerance"
                                                 Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                                 VerticalContentAlignment="Center">
                                                        <TextBox.Text>
                                                            <Binding Path="MassTolerance" 
                                                         ValidatesOnDataErrors="True" 
                                                         UpdateSourceTrigger="LostFocus" 
                                                         NotifyOnValidationError="True">
                                                                <Binding.ValidationRules>
                                                                    <local:PositiveDoubleNumericValidation />
                                                                </Binding.ValidationRules>
                                                            </Binding>
                                                        </TextBox.Text>
                                                    </TextBox>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>

                                            <DataGridTemplateColumn.CellEditingTemplate>
                                                <DataTemplate>
                                                    <Grid  FocusManager.FocusedElement="{Binding ElementName= TextBox_MassTolerance}">
                                                        <TextBox Name="TextBox_MassTolerance" 
                                                     Text="{Binding MassTolerance, UpdateSourceTrigger=LostFocus}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellEditingTemplate>

                                        </DataGridTemplateColumn>

                                    </DataGrid.Columns>
                                </DataGrid>

                            </Grid>

                        </Expander>
                    </Grid>

                </Grid>
            </TabItem>

            <TabItem Name="TabItem_Deconvolution" Header="MS2Dec">
                <Grid>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="90" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Label Content="Deconvolution parameters" Grid.Row="0" Grid.ColumnSpan="3" FontStyle="Italic" Margin="10,0,0,0" />

                        <StackPanel Orientation="Vertical" Grid.Row="0" Grid.Column="0" Margin="20, 25, 0,0">
                            <Label Content="Sigma window value:" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="MS/MS abundance cut off:" Height="30" VerticalContentAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Row="0" Grid.Column="1" Margin="0, 25, 0,0">

                            <TextBox Name="TextBox_SigmaWindowValue" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="SigmaWindowValue" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="Recommend: 0.1-1.0" />
                                </ToolTipService.ToolTip>
                            </TextBox>

                            <TextBox Name="TextBox_MS2AbundanceCutOff" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="AmplitudeCutoff" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="Recommend: 0-100" />
                                </ToolTipService.ToolTip>
                            </TextBox>

                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Row="0" Grid.Column="2" Margin="0, 25, 0,0">
                            <Label Content="" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="amplitude" Height="30" VerticalContentAlignment="Center"/>
                        </StackPanel>
                    </Grid>

                    <Grid Grid.Row="1">
                        <Expander Header="Advanced"
                                  HorizontalAlignment="Stretch" 
                                  VerticalAlignment="Stretch" 
                                  ExpandDirection="Down">

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <StackPanel Orientation="Vertical" Grid.Row="1" Grid.Column="0" Margin="20, 0, 0,0">
                                    <Label Content="Exclude after precursor ion:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Keep the isotopic ions until:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Keep the isotopic ions w/o MS2Dec:" Height="30" VerticalContentAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Orientation="Vertical" Grid.Row="1" Grid.Column="1" Margin="0, 0, 0,0">

                                    <CheckBox Name="CheckBox_ExcludeAfterPrecursor" HorizontalAlignment="Left" VerticalAlignment="Center" IsChecked="{Binding Path=RemoveAfterPrecursor}" Margin="5,10,0,0">
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="If you want to remove the ions after precursor, please check." />
                                        </ToolTipService.ToolTip>
                                    </CheckBox>

                                    <TextBox Name="TextBox_KeepIsotopicIonsUntil" 
                                             Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  
                                             HorizontalAlignment="Stretch" 
                                             HorizontalContentAlignment="Right" 
                                             IsEnabled="{Binding Path=RemoveAfterPrecursor}"
                                             Height="25" Margin="5,8,5,2.5">    
                                        <TextBox.Text>
                                            <Binding Path="KeptIsotopeRange" 
                                         ValidatesOnDataErrors="True" 
                                         UpdateSourceTrigger="LostFocus" 
                                         NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="Recommend: 0.5-3" />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                    <CheckBox Name="CheckBox_KeepIsotopicIonsWithoutMs2Dec" HorizontalAlignment="Left" 
                                  VerticalAlignment="Center" IsChecked="{Binding Path=KeepOriginalPrecursorIsotopes }" Margin="5,7,0,0">
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="If you want to keep the original precursor's isotopic ions, please check." />
                                        </ToolTipService.ToolTip>
                                    </CheckBox>


                                </StackPanel>

                                <StackPanel Orientation="Vertical" Grid.Row="1" Grid.Column="2" Margin="0, 0, 0,0">
                                    <Label Content="" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>
                                </StackPanel>

                            </Grid>
                            
                            
                        </Expander>
                    </Grid>
                 
                </Grid>
            </TabItem>

            <TabItem Name="TabItem_Identification" Header="Identification">
                <Grid>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="245" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">

                        <Grid.RowDefinitions>
                            <RowDefinition Height="30" />
                            <RowDefinition Height="40" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Label Content="MSP file and MS/MS identification setting" FontStyle="Italic" Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,0,0" />

                        <Label Content="MSP file: " Grid.Row="1" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="20,5,5,5" />
                        <TextBox Name="TextBox_LibraryFilePath" Grid.Row="1" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" Text="{Binding Path=LibraryFilePath, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch" VerticalAlignment="Center" Height="24" Margin="90, 0, 70, 0" />
                        <Button Name="Button_LibraryFilePathSelect" Content="Select" Grid.Row="1" Click="Click_DatabaseFilePathSelect" HorizontalAlignment="Right" VerticalAlignment="Center" Height="24" Width="60" Margin="0,0,5,0" >
                            <ToolTipService.ToolTip>
                                <ToolTip Content="Now, MSP format is just acceptable." />
                            </ToolTipService.ToolTip>
                        </Button>

                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="3*" />
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 0, 0,0">
                                <Label Content="Retention time tolerance:" Height="27" VerticalContentAlignment="Center" />
                                <Label Content="Accurate mass tolerance (MS1):" Height="27" VerticalContentAlignment="Center"/>
                                <Label Content="Accurate mass tolerance (MS2):" Height="27" VerticalContentAlignment="Center"/>
                                <Label Content="Identification score cut off:" Height="27" VerticalContentAlignment="Center"/>
                                <Label Content="Use retention time for scoring:" Height="27" VerticalContentAlignment="Center"/>
                                <Label Content="Use retention time for filtering:" Height="27" VerticalContentAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 0, 0,0">
                                <TextBox Name="TextBox_RetentionTimeLibrarySearchTolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                    <TextBox.Text>
                                        <Binding Path="RetentionTimeLibrarySearchTolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                            <Binding.ValidationRules>
                                                <local:PositiveDoubleNumericValidation />
                                            </Binding.ValidationRules>
                                        </Binding>
                                    </TextBox.Text>
                                </TextBox>
                                <TextBox Name="TextBox_Ms1LibrarySearchTolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                    <TextBox.Text>
                                        <Binding Path="Ms1LibrarySearchTolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                            <Binding.ValidationRules>
                                                <local:PositiveDoubleNumericValidation />
                                            </Binding.ValidationRules>
                                        </Binding>
                                    </TextBox.Text>
                                </TextBox>
                                <TextBox Name="TextBox_Ms2LibrarySearchTolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                    <TextBox.Text>
                                        <Binding Path="Ms2LibrarySearchTolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnSourceUpdated="True">
                                            <Binding.ValidationRules>
                                                <local:PositiveDoubleNumericValidation />
                                            </Binding.ValidationRules>
                                        </Binding>
                                    </TextBox.Text>
                                </TextBox>
                                <TextBox Name="TextBox_IdentificationScoreCutOff" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                    <TextBox.Text>
                                        <Binding Path="IdentificationScoreCutOff" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnSourceUpdated="True">
                                            <Binding.ValidationRules>
                                                <local:PositiveDoubleNumericValidation />
                                            </Binding.ValidationRules>
                                        </Binding>
                                    </TextBox.Text>
                                </TextBox>

                                <CheckBox Name="CheckBox_IsUseRetentionForIdentificationScoring" 
                                      HorizontalAlignment="Left" 
                                      VerticalAlignment="Center" 
                                      IsChecked="{Binding Path=IsUseRetentionInfoForIdentificationScoring}" 
                                      Margin="5,7.5,0,0">

                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="If unchecked, RT similarity is not used in total score." />
                                    </ToolTipService.ToolTip>

                                </CheckBox>

                                <CheckBox Name="CheckBox_IsUseRetentionForIdentificationFiltering" 
                                      HorizontalAlignment="Left" 
                                      VerticalAlignment="Center" 
                                      IsChecked="{Binding Path=IsUseRetentionInfoForIdentificationFiltering}" 
                                      Margin="5,13,0,0">

                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="If checked, RT is used for filtering candidates out." />
                                    </ToolTipService.ToolTip>

                                </CheckBox>

                            </StackPanel>
                            <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 0, 0,0">
                                <Label Content="min" Height="27" VerticalAlignment="Center"/>
                                <Label Content="Da" Height="27" VerticalContentAlignment="Center"/>
                                <Label Content="Da" Height="27" VerticalContentAlignment="Center"/>
                                <Label Content="%" Height="27" VerticalContentAlignment="Center"/>
                            </StackPanel>
                        </Grid>

                    </Grid>

                    <Grid Grid.Row="1">
                        <Expander Header="Advanced"
                                  HorizontalAlignment="Stretch" 
                                  VerticalAlignment="Stretch" 
                                  ExpandDirection="Down">

                            <Grid>

                                <Grid.RowDefinitions>
                                    <RowDefinition Height="30" />
                                    <RowDefinition Height="40" />
                                    <RowDefinition Height="90" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <Label Content="Text file and post identification (retention time and accurate mass based) setting" FontStyle="Italic" 
                                       Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,0,0" />

                                <Label Content="Text file: " Grid.Row="1" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="20,5,5,5" />
                                
                                <TextBox Name="TextBox_PostIdentificationLibraryFilePath" 
                                         Grid.Row="1" 
                                         Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                         Text="{Binding Path=PostIdentificationLibraryFilePath, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" 
                                         HorizontalAlignment="Stretch" VerticalAlignment="Center"
                                         Height="24" Margin="90, 0, 70, 0" />
                                <Button Name="Button_PostIdentificationLibraryFilePathSelect" Content="Select" Grid.Row="1" 
                                        Click="Click_TextReferenceFilePathSelect" HorizontalAlignment="Right" 
                                        VerticalAlignment="Center" Height="24" Width="60" Margin="0,0,5,0" >
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Text file should include a compound list consisting of metabolite name (first column), accurate mass (second column), and retention time (third). A row header is considered." />
                                    </ToolTipService.ToolTip>
                                </Button>

                                <Grid Grid.Row="2">
                                   
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="3*" />
                                        <ColumnDefinition Width="2*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 0, 0,0">
                                        <Label Content="Retention time tolerance:" Height="27" VerticalContentAlignment="Center" />
                                        <Label Content="Accurate mass tolerance:" Height="27" VerticalContentAlignment="Center"/>
                                        <Label Content="Identification score cut off:" Height="27" VerticalContentAlignment="Center"/>
                                    </StackPanel>
                                 
                                    <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 0, 0,0">
                                        <TextBox Name="TextBox_RetentionTimeToleranceOfPostIdentification" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                            <TextBox.Text>
                                                <Binding Path="RetentionTimeToleranceOfPostIdentification" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                    <Binding.ValidationRules>
                                                        <local:PositiveDoubleNumericValidation />
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                        </TextBox>
                                        <TextBox Name="TextBox_AccurateMassToleranceOfPostIdentification" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                            <TextBox.Text>
                                                <Binding Path="AccurateMassToleranceOfPostIdentification" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                    <Binding.ValidationRules>
                                                        <local:PositiveDoubleNumericValidation />
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                        </TextBox>
                                        <TextBox Name="TextBox_PostIdentificationScoreCutOff" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                            <TextBox.Text>
                                                <Binding Path="PostIdentificationScoreCutOff" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnSourceUpdated="True">
                                                    <Binding.ValidationRules>
                                                        <local:PositiveDoubleNumericValidation />
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                        </TextBox>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 0, 0,0">
                                        <Label Content="min" Height="27" VerticalAlignment="Center"/>
                                        <Label Content="Da" Height="27" VerticalContentAlignment="Center"/>
                                        <Label Content="%" Height="27" VerticalContentAlignment="Center"/>
                                    </StackPanel>
                                </Grid>

                                <Grid Grid.Row="3">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="3*" />
                                        <ColumnDefinition Width="2*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Label Content="Spectrum cut off and report option" FontStyle="Italic" 
                                           Grid.ColumnSpan="3"
                                                Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="10,0,0,0" />

                                    <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 30, 0,0">
                                        <Label Content="Relative abundance cut off:" Height="27" VerticalContentAlignment="Center"/>
                                        <Label Content="Only report the top hit:" Height="27" VerticalContentAlignment="Center"/>
                                    </StackPanel>

                                    <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 30, 0,0">

                                        <TextBox Name="TextBox_RelativeAbundanceCutOff" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  
                                                 HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="27" Margin="5,0,5,2.5">
                                            <TextBox.Text>
                                                <Binding Path="RelativeAbundanceCutOff" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                    <Binding.ValidationRules>
                                                        <local:PositiveDoubleNumericValidation />
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                            <ToolTipService.ToolTip>
                                                <ToolTip Content="The peak less than defined-abundance will not be used for similarity calculations" />
                                            </ToolTipService.ToolTip>
                                        </TextBox>

                                        <CheckBox Name="CheckBox_OnlyReportTopHitForPostAnnotation" HorizontalAlignment="Left"
                                                  VerticalAlignment="Center" IsChecked="{Binding Path=OnlyReportTopHitForPostAnnotation}" 
                                                  Unchecked="CheckBox_OnlyReportTopHitForPostAnnotation_Unchecked"
                                                  Checked="CheckBox_OnlyReportTopHitForPostAnnotation_Checked" Margin="5,5,0,0">
                                            <ToolTipService.ToolTip>
                                                <ToolTip Content="One result having the top score will be reported as a result of the post identification process." />
                                            </ToolTipService.ToolTip>
                                        </CheckBox>

                                    </StackPanel>
                                    <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 30, 0,0">
                                        <Label Content="%" Height="27" VerticalAlignment="Center"/>
                                    </StackPanel>

                                </Grid>

                            </Grid>


                        </Expander>
                    </Grid>

                </Grid>
            </TabItem>

            <TabItem Name="TabItem_Adduct" Header="Adduct">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="30" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Label Content="Adduct ion setting" FontStyle="Italic" Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="5,0,0,0" />
                        <Button Content="User-defined adduct" Click="Button_AdductIonAdd_Click" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,5,0" Height="25" Width="120" />
                        
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="1" />
                            </Grid.ColumnDefinitions>
                            <DataGrid Name="DataGrid_AdductIonSetting" 
                                      Grid.Column="0" ItemsSource="{Binding Path=AdductIonInformationViewModelCollection}" 
                                      CanUserAddRows="False" CanUserDeleteRows="False" CanUserReorderColumns="False" 
                                      CanUserSortColumns="False" SelectionUnit="Cell" IsReadOnly="False" 
                                      HeadersVisibility="All" AutoGenerateColumns="False" Margin="5,0,0,0">
                                
                                <DataGrid.ColumnHeaderStyle>
                                    <Style TargetType="DataGridColumnHeader" >
                                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    </Style>
                                </DataGrid.ColumnHeaderStyle>

                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Molecular species" Width="2*" Binding="{Binding AdductName}" IsReadOnly="True" />
                                    <DataGridTextColumn Header="Charge" Width="*" Binding="{Binding Charge}" IsReadOnly="True" />
                                    <DataGridTextColumn Header="Accurate mass [Da]" Width="2*" Binding="{Binding AccurateMass}" IsReadOnly="True" />
                                   
                                    <!--<DataGridCheckBoxColumn Header="Included" Width="80" Binding="{Binding Included}" IsReadOnly="False" />-->

                                    <DataGridTemplateColumn Width="80" Header="Included">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox 
                                                    IsChecked="{Binding Path=Included, 
                                                    Mode=TwoWay, 
                                                    UpdateSourceTrigger=PropertyChanged}" 
                                                    HorizontalAlignment="Center" 
                                                    VerticalAlignment="Center" 
                                                    HorizontalContentAlignment="Center" 
                                                    VerticalContentAlignment="Center" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Grid>
                </Grid>
            </TabItem>
            
            <TabItem Name="TabItem_Alignment" Header="Alignment">
              
                <Grid>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="160" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="4*" />
                            <ColumnDefinition Width="3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="30" />
                            <RowDefinition Height="300" />
                        </Grid.RowDefinitions>

                        <Label Content="Alignment parameters setting" FontStyle="Italic" Grid.ColumnSpan="2"
                               Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="5,0,0,0" />

                        <StackPanel Orientation="Vertical" Grid.Column="0" 
                                    Grid.Row="1" Margin="20,0,0,0" Grid.ColumnSpan="2">

                            <Label Content="Result name:" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="Reference file:" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="Retention time tolerance:" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="MS1 tolerance:" Height="30" VerticalContentAlignment="Center"/>

                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="1" Grid.Row="1" Margin="0,0,0,0" >
                         
                            <TextBox Name="TextBox_AlignmentResultFileName" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="AlignmentResultFileName" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True" />
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="Decide an alignment file name" />
                                </ToolTipService.ToolTip>
                            </TextBox>

                            <ComboBox Name="ComboBox_ReferenceFileID" SelectionChanged="ComboBox_ReferenceFileID_SelectionChanged" ItemsSource="{Binding}" Height="25" Margin="5,2.5,5,2.5" HorizontalAlignment="Stretch" />

                            <TextBox Name="TextBox_RetentionTimeAlignmentTolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="RetentionTimeAlignmentTolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="At least for ODS column, 0.05-0.1 is better." />
                                </ToolTipService.ToolTip>
                            </TextBox>
                          
                            <TextBox Name="TextBox_Ms1AlignmentTolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                <TextBox.Text>
                                    <Binding Path="Ms1AlignmentTolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="At least for QTOF, 0.01-0.025 is better." />
                                </ToolTipService.ToolTip>
                            </TextBox>
                          
                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="2" Grid.Row="1" Margin="0,0,0,0" Grid.ColumnSpan="2">

                            <Label Content="" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="min" Height="30" VerticalContentAlignment="Center"/>
                            <Label Content="Da" Height="30" VerticalContentAlignment="Center"/>

                        </StackPanel>


                    </Grid>

                    <Grid Grid.Row="1">
                        <Expander Header="Advanced"
                                  HorizontalAlignment="Stretch" 
                                  VerticalAlignment="Stretch" 
                                  ExpandDirection="Down">

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="4*" />
                                    <ColumnDefinition Width="3*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>


                                <StackPanel Orientation="Vertical" Grid.Column="0" Grid.Row="1" Margin="20,0,0,0">

                                    <Label Content="Retention time factor:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="MS1 factor:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="Peak count filter:" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="N% detected in at least one group:" Height="30" VerticalContentAlignment="Center"/>
                                    <!--<Label Content="Detected in all QCs" Grid.Row="2" Grid.ColumnSpan="3" Height="30" 
                                           HorizontalAlignment="Left" VerticalContentAlignment="Center" />-->
                                    <!--<Label Content="Replace zero with 1/2 of minimum peak height: " Height="30" HorizontalAlignment="Left" VerticalContentAlignment="Center" />-->
                                    <Label Content="Remove features based on blank information: " Height="30" HorizontalAlignment="Left" VerticalContentAlignment="Center" />
                                    <ComboBox Name="ComboBox_FilteringMethod" ItemsSource="{Binding}" 
                                              SelectionChanged="ComboBox_FilteringMethod_SelectionChanged" 
                                              HorizontalContentAlignment="Left" 
                                              HorizontalAlignment="Stretch" 
                                              Height="25" Margin="5,2.5,30,2.5">
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="Select the filtering criterion." />
                                        </ToolTipService.ToolTip>
                                    </ComboBox>
                                    <!--<Label Content="Sample max / blank average: " Height="30" HorizontalAlignment="Left" VerticalContentAlignment="Center" />
                                    <Label Content="Sample average / blank average: " Height="30" HorizontalAlignment="Left" VerticalContentAlignment="Center" />-->
                                    <Label Content="Keep 'reference matched' metabolite features: " Height="30" HorizontalAlignment="Left" VerticalContentAlignment="Center" />
                                    <Label Content="Keep 'suggested (w/o MS2)' metabolite features: " Height="30" HorizontalAlignment="Left" VerticalContentAlignment="Center" />
                                    <Label Content="Keep removable features and assign the tag: " Height="30" HorizontalAlignment="Left" VerticalContentAlignment="Center" />
                                    <Label Content="Gap filling by compulsion:" Grid.Row="2" Grid.ColumnSpan="3" Height="30" HorizontalAlignment="Left" VerticalContentAlignment="Center" />

                                </StackPanel>

                                <StackPanel Orientation="Vertical" Grid.Column="1" Grid.Row="1" Margin="0,0,0,0" >


                                    <TextBox Name="TextBox_RetentionTimeAlignmentFactor" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"  HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="RetentionTimeAlignmentFactor" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="At least for ODS column, 0.5 is good." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>
                                    
                                    <TextBox Name="TextBox_Ms1AlignmentFactor" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="Ms1AlignmentFactor" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="At least for QTOF column, 0.5-0.7 is good." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                    <TextBox Name="TextBox_PeakCountFilter" Style="{StaticResource ResourceKey=ToolTipErrorStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,2.5,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="PeakCountFilter" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnSourceUpdated="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="Aligned peaks which are less than this parameter will be removed from the final result." />
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                    <TextBox Name="TextBox_NpercentDetectedInOneGroup" 
                                            Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                            HorizontalAlignment="Stretch" 
                                            HorizontalContentAlignment="Right" 
                                            Height="25" 
                                            Margin="5,2,5,2.5">
                                            <TextBox.Text>
                                                <Binding Path="NPercentDetectedInOneGroup" 
                                             ValidatesOnDataErrors="True" 
                                             UpdateSourceTrigger="LostFocus" 
                                             NotifyOnSourceUpdated="True">
                                                    <Binding.ValidationRules>
                                                        <local:PositiveDoubleNumericValidation />
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="Present in at least n% of samples in at least one sample group." />
                                        </ToolTipService.ToolTip>   
                                    </TextBox>

                                    <!--<CheckBox Name="CheckBox_QcAtLeastFilter" Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" IsChecked="{Binding Path=QcAtLeastFilter}" Margin="5,8,0,0">
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="If you have some or a lot of QC samples, this option is very powerful." />
                                        </ToolTipService.ToolTip>
                                    </CheckBox>-->

                                    <!--<CheckBox Name="CheckBox_IsReplaceTrueZeroValuesWithHalfOfMinimumPeakHeightOverAllSamples" 
                                              Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" 
                                              IsChecked="{Binding Path=IsReplaceTrueZeroValuesWithHalfOfMinimumPeakHeightOverAllSamples}" Margin="5,16,0,0">
                                    </CheckBox>-->

                                    <CheckBox Name="CheckBox_IsRemoveFeatureBasedOnPeakHeightFoldChange" 
                                              Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" 
                                              IsChecked="{Binding Path=IsRemoveFeatureBasedOnPeakHeightFoldChange}" Margin="5,9,0,0">
                                    </CheckBox>

                                    <TextBox Name="TextBox_FoldChangeForBlankFiltering" 
                                             Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                             IsEnabled="{Binding Path=IsRemoveFeatureBasedOnPeakHeightFoldChange}"
                                             HorizontalAlignment="Stretch" 
                                             HorizontalContentAlignment="Right" 
                                             Height="25" 
                                             Margin="5,9,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="FoldChangeForBlankFiltering" 
                                             ValidatesOnDataErrors="True" 
                                             UpdateSourceTrigger="LostFocus" 
                                             NotifyOnSourceUpdated="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <ToolTip>
                                                <TextBlock>
                                                    1. For instance, if a fold-change of 10 is used: for an average peak height over all samples (or max. value in all samples) of 10,000 
                                                <LineBreak /> 
                                                     and an average peak height in blanks of 500, the fold-change 10,000/500 = 20 means that this feature stays in the data set.
                                                <LineBreak /> 
                                                  2. Users must specify in File property setting -> File type which files are blanks and actual samples.
                                                <LineBreak /> 
                                                     if more blanks are available, an average value would be used for calculation.
                                                <LineBreak /> 
                                                  3. If in blanks all values are zero (even after gap filling), 1/10 of minimal peak height over all samples is used.
                                                </TextBlock>
                                            </ToolTip>
                                        </ToolTipService.ToolTip>
                                    </TextBox>

                                    <!--<TextBox Name="TextBox_SampleAverageOverBlankAverage" 
                                             Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                             IsEnabled="{Binding Path=IsRemoveFeatureBasedOnPeakHeightFoldChange}"
                                             HorizontalAlignment="Stretch" 
                                             HorizontalContentAlignment="Right" 
                                             Height="25" 
                                             Margin="5,2,5,2.5">
                                        <TextBox.Text>
                                            <Binding Path="SampleAverageOverBlankAverage" 
                                             ValidatesOnDataErrors="True" 
                                             UpdateSourceTrigger="LostFocus" 
                                             NotifyOnSourceUpdated="True">
                                                <Binding.ValidationRules>
                                                    <local:PositiveDoubleNumericValidation />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                        <ToolTipService.ToolTip>
                                            <TextBlock>
                                                  1. for instance: if fold-change 10 would be used: average peak height over all samples (or max. value in all samples)
                                                <LineBreak /> 
                                                     is 10,000; average blank peak height is 500  => 10,000 / 500 = 20 => feature would stay in the dataset.
                                                <LineBreak /> 
                                                  2. users must specify in File property setting which samples are BLANKS and SAMPLES; 
                                                <LineBreak /> 
                                                     if more blanks are available, an average value would be used for calculation.
                                                <LineBreak /> 
                                                  3. if in blanks all values would be zero, a half of minimal peak heights over all samples would be used
                                            </TextBlock>
                                        </ToolTipService.ToolTip>
                                    </TextBox>-->

                                    <CheckBox Name="CheckBox_IsKeepIdentifiedMetaboliteFeatures" 
                                              Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" 
                                              IsEnabled="{Binding Path=IsRemoveFeatureBasedOnPeakHeightFoldChange}"
                                              IsChecked="{Binding Path=IsKeepIdentifiedMetaboliteFeatures}" Margin="5,9,0,0">
                                        <ToolTipService.ToolTip>
                                            <TextBlock>
                                                  This would allow the user to retain their, for example, internal standards before removing all features 
                                                <LineBreak /> 
                                                  that are not at least x-fold greater intensity in the samples than in the blanks.
                                            </TextBlock>
                                        </ToolTipService.ToolTip>

                                    </CheckBox>

                                    <CheckBox Name="CheckBox_IsKeepAnnotatedMetaboliteFeatures" 
                                              Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" 
                                              IsEnabled="{Binding Path=IsRemoveFeatureBasedOnPeakHeightFoldChange}"
                                              IsChecked="{Binding Path=IsKeepAnnotatedMetaboliteFeatures}" Margin="5,16,0,0">
                                        <ToolTipService.ToolTip>
                                            <TextBlock>
                                                  This would allow the user to retain their, for example, internal standards before removing all features 
                                                <LineBreak /> 
                                                  that are not at least x-fold greater intensity in the samples than in the blanks.
                                            </TextBlock>
                                        </ToolTipService.ToolTip>

                                    </CheckBox>

                                    <CheckBox Name="CheckBox_IsKeepRemovableFeaturesAndAssignedTagForChecking" 
                                              Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" 
                                              IsEnabled="{Binding Path=IsRemoveFeatureBasedOnPeakHeightFoldChange}"
                                              IsChecked="{Binding Path=IsKeepRemovableFeaturesAndAssignedTagForChecking}" Margin="5,15,0,0">
                                        <ToolTipService.ToolTip>
                                            <TextBlock>
                                                  All features are kept even if the filtering is applied, but users can check if the feature is satisfied with the blank checking or not.
                                                <LineBreak /> 
                                                  Moreover, users can export the alignment result by the filtering options.
                                            </TextBlock>
                                        </ToolTipService.ToolTip>

                                    </CheckBox>

                                    <CheckBox Name="CheckBox_IsForceInsertForGapFilling" Grid.Row="2" 
                                          HorizontalAlignment="Left" 
                                          VerticalAlignment="Center" 
                                          IsChecked="{Binding Path=IsForceInsertForGapFilling}" Margin="5,15,0,0">
                                        <ToolTipService.ToolTip>
                                            <ToolTip Content="Ad hoc peak area is forcibly detected within +- 5 data points even if there is no local maximum. " />
                                        </ToolTipService.ToolTip>
                                    </CheckBox>



                                </StackPanel>

                                <StackPanel Orientation="Vertical" Grid.Column="2" Grid.Row="1" Margin="0,0,0,0" Grid.ColumnSpan="2">

                                    <Label Content="(0-1)" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="(0-1)" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="%" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="%" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="" Height="30" VerticalContentAlignment="Center"/>
                                    <Label Content="fold change" Height="30" VerticalContentAlignment="Center"/>

                                </StackPanel>

                            </Grid>

                        </Expander>
                    </Grid>

                </Grid>
            </TabItem>

            <TabItem Name="TabItem_Mobility" Header="Mobility">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="30" />
                        <RowDefinition Height="80" />
                        <RowDefinition Height="30" />
                        <RowDefinition Height="40" />
                        <RowDefinition Height="30" />
                        <RowDefinition Height="90" />
                        <RowDefinition Height="30" />
                        <RowDefinition Height="40" />
                    </Grid.RowDefinitions>

                    <Label Content="Mobility type" Grid.Row="0" FontStyle="Italic" VerticalAlignment="Center" Margin="5,0,0,0" />
                    <Grid Name="Grid_MobilityTypeSetting" Grid.Row="1">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="10,5,5,5">
                            <RadioButton Name="RadioButton_UseTIMS" Content="TIMS (Bruker)" IsChecked="{Binding Path=IsTIMS}" VerticalAlignment="Center" Margin="14,1,0,0" />
                            <RadioButton Name="RadioButton_UseDTIMS" Content="DTIMS (Agilent)" IsChecked="{Binding Path=IsDTIMS}" VerticalAlignment="Center" Margin="14,1,0,0" />
                            <RadioButton Name="RadioButton_UseTWIMS" Content="TWIMS (Waters)" IsChecked="{Binding Path=IsTWIMS}" VerticalAlignment="Center" Margin="14,1,0,0" />
                        </StackPanel>

                        <Label Content="CCS calibration data: " HorizontalAlignment="Left" VerticalAlignment="Top" Margin="20,35,5,5" />

                        <Button Name="Button_CcsCoeffDataSet" Content="Set" Click="Click_CcsData_Browse" 
                                HorizontalAlignment="Left" VerticalAlignment="Top" Height="24" Width="80" Margin="140,38,5,0" >
                            <ToolTipService.ToolTip>
                                <ToolTip Content="For CCS calculation, calibration information (TFix and Beta for Agilent single field, Coeff, Exponent, and T0 for Waters) can be set from here." />
                            </ToolTipService.ToolTip>
                        </Button>

                        <Label Name="Label_CcsCalibrantImport" Content="Status: " HorizontalAlignment="Left" VerticalAlignment="Top" Height="30" Margin="225, 35, 0, 0" />

                    </Grid>

                    <Label Content="Peak picking" FontStyle="Italic" 
                           Grid.Row="2" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0,0,0" />

                    <Grid Grid.Row="3">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 0, 0,0">
                            <Label Content="Accumulated RT range:" Height="27" VerticalContentAlignment="Center" />

                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 0, 0,0">
                            <TextBox Name="TextBox_AccumulatedRtRagne" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"
                                     HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                <TextBox.Text>
                                    <Binding Path="AccumulatedRtRagne" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                            </TextBox>
                           

                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 0, 0,0">
                            <Label Content="min" Height="27" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>

                    <Label Content="Identification" FontStyle="Italic" 
                           Grid.Row="4" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0,0,0" />

                    <Grid Grid.Row="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 0, 0,0">
                            <Label Content="CCS tolerance:" Height="27" VerticalContentAlignment="Center" />
                            <Label Content="Use CCS for scoring:" Height="27" VerticalContentAlignment="Center"/>
                            <Label Content="Use CCS for filtering metabolites:" Height="27" VerticalContentAlignment="Center"/>

                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 0, 0,0">
                            <TextBox Name="TextBox_CcsLibrarySearchTolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"
                                     HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                <TextBox.Text>
                                    <Binding Path="CcsSearchTolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                            </TextBox>

                            <CheckBox Name="CheckBox_IsUseCcsForScoring" 
                                      HorizontalAlignment="Left" 
                                      VerticalAlignment="Center" 
                                      IsChecked="{Binding Path=IsUseCcsForIdentificationScoring}" 
                                      Margin="5,8,0,0">

                                <ToolTipService.ToolTip>
                                    <ToolTip Content="If checked, CCS is used for scoring candidates." />
                                </ToolTipService.ToolTip>

                            </CheckBox>

                            <CheckBox Name="CheckBox_IsUseCcsForFiltering" 
                                      HorizontalAlignment="Left" 
                                      VerticalAlignment="Center" 
                                      IsChecked="{Binding Path=IsUseCcsForIdentificationFiltering}" 
                                      Margin="5,12,0,0">

                                <ToolTipService.ToolTip>
                                    <ToolTip Content="If checked, CCS is used for filtering candidates out." />
                                </ToolTipService.ToolTip>

                            </CheckBox>

                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 0, 0,0">
                            <Label Content="Ao^2" Height="27" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>

                    <Label Content="Alignment" FontStyle="Italic" 
                           Grid.Row="6" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,0,0,0" />

                    <Grid Grid.Row="7">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Vertical" Grid.Column="0" Margin="20, 0, 0,0">
                            <Label Content="Mobility tolerance:" Height="27" VerticalContentAlignment="Center" />
                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0, 0, 0,0">
                            <TextBox Name="TextBox_MobilityTolerance" Style="{StaticResource ResourceKey=ToolTipErrorStyle}"
                                     HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Height="25" Margin="5,1,5,1">
                                <TextBox.Text>
                                    <Binding Path="DriftTimeAlignmentTolerance" ValidatesOnDataErrors="True" UpdateSourceTrigger="LostFocus" NotifyOnValidationError="True">
                                        <Binding.ValidationRules>
                                            <local:PositiveDoubleNumericValidation />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                            </TextBox>

                        </StackPanel>

                        <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0, 0, 0,0">
                            <Label Content="{Binding MobilityUnit}" Height="27" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabItem>
            
            <TabItem Name="TabItem_IsotopeTrack" Header="Isotope tracking">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="30" />
                        <RowDefinition Height="250" />
                    </Grid.RowDefinitions>

                    <Label Content="Tracking of isotope labels" FontStyle="Italic" 
                           Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="5,0,0,0" />

                    <CheckBox Name="CheckBox_TrackingIsotopeLabels" 
                              Grid.Row="0" Grid.Column="1" HorizontalAlignment="Left" VerticalAlignment="Center" IsChecked="{Binding Path=TrackingIsotopeLabels}" IsEnabled="True" Margin="5,0,0,0">
                        <ToolTipService.ToolTip>
                            <ToolTip Content="Check this option if you want to track isotope labels." />
                        </ToolTipService.ToolTip>
                    </CheckBox>

                    <GroupBox Name="GroupBox_TrackingIsotopicLables" 
                              Grid.Row="1" Grid.ColumnSpan="3" 
                              HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                              IsEnabled="{Binding Path=TrackingIsotopeLabels}">

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Vertical" Grid.Column="0" Margin="14,0,0,0">

                                <Label Content="Labeled element:" 
                                       Height="30" VerticalContentAlignment="Center"/>
                                <Label Content="Non-labeled reference file:" 
                                       Height="30" VerticalContentAlignment="Center"/>
                                <CheckBox Content="Use target formula library: " 
                                          Height="30" VerticalContentAlignment="Center" 
                                          IsChecked="{Binding Path=UseTargetFormulaLibrary}" Margin="4,0,0,0"/>
                                <CheckBox Content="Set fully-labeled reference file: " 
                                          Height="30" VerticalContentAlignment="Center" 
                                          IsChecked="{Binding Path=SetFullyLabeledReferenceFile}" Margin="4,0,0,0"/>

                            </StackPanel>

                            <StackPanel Orientation="Vertical" Grid.Column="1" Grid.Row="1" Margin="0,0,0,0" >

                                <ComboBox Name="ComboBox_LabeledElement" 
                                          SelectionChanged="ComboBox_LabeledElement_SelectionChanged" 
                                          ItemsSource="{Binding}" 
                                          Height="25" Margin="5,2.5,5,2.5" HorizontalAlignment="Stretch" />
                                
                                <ComboBox Name="ComboBox_NonLabeledReference" 
                                          SelectionChanged="ComboBox_NonLabeledReference_SelectionChanged" 
                                          ItemsSource="{Binding}" 
                                          Height="25" Margin="5,2.5,5,2.5" HorizontalAlignment="Stretch" />
                                
                                <TextBox Name="TextBox_TargetFormulaLibraryFilePath" Grid.Row="4" 
                                         Style="{StaticResource ResourceKey=ToolTipErrorStyle}" 
                                         Text="{Binding Path=TargetFormulaLibraryFilePath, 
                                                        ValidatesOnDataErrors=True, 
                                                        UpdateSourceTrigger=PropertyChanged}" 
                                         HorizontalAlignment="Stretch" VerticalAlignment="Center" Height="24" Margin="5, 4, 5, 0" />


                                <ComboBox Name="ComboBox_FullyLabeledReference" 
                                          SelectionChanged="ComboBox_FullyLabeledReference_SelectionChanged" 
                                          ItemsSource="{Binding}" 
                                          IsEnabled="{Binding Path=SetFullyLabeledReferenceFile}"
                                          Height="25" Margin="5,5,5,2.5" HorizontalAlignment="Stretch" />

                            </StackPanel>

                            <StackPanel Orientation="Vertical" Grid.Column="2" Grid.Row="1" Margin="0,0,0,0" >

                                <Label Content="" Height="30" VerticalContentAlignment="Center"/>
                                <Label Content="" Height="30" VerticalContentAlignment="Center"/>

                                <Button Name="Button_TargetFormulaLibrarySelect" Content="Select" Grid.Row="4" Click="Click_TargetFormulaLibraryFilePathSelect" VerticalAlignment="Center" Height="24" HorizontalAlignment="Stretch" Margin="5,4,5,0" IsEnabled="{Binding Path=UseTargetFormulaLibrary}" >
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Text file should include a compound list consisting of formula (first column), accurate mass (second column), retention time (third), and adduct type (forth). A row header is considered." />
                                    </ToolTipService.ToolTip>
                                </Button>
                            </StackPanel>

                        </Grid>

                    </GroupBox>
                </Grid>
            </TabItem>
        
        </TabControl>
        <Button x:Name="Cancel" Content="Cancel" Click="Click_Cancel" Grid.Row="1" Height="25" Width="70" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,5,5,5" />
        <Button x:Name="Finish" Content="Finish" Command="{Binding OkCommand}" Grid.Row="1" Height="25" Width="70" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,5,80,5" />
        <Button x:Name="Load" Content="Load" Click="Click_Load" Grid.Row="1" Height="25" Width="70" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,5,5,5">
            <ToolTipService.ToolTip>
                <ToolTip Content="Load your parameters" />
            </ToolTipService.ToolTip>
        </Button>
        <CheckBox Name="CheckBox_WithAlignment" Content="Together with Alignment" Grid.Row="1" HorizontalAlignment="Left" VerticalAlignment="Center" IsChecked="{Binding Path=TogetherWithAlignment}" Margin="90,0,0,0" />
    </Grid>
</Window>
